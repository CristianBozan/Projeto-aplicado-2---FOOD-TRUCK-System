@startuml
start
:Receber request /backups/:id/restore;
:Carregar backup (conteudo_json);
if (mode == 'force'?) then (sim)
  :Apagar pedidos, itens e vendas atuais;
  :Recriar pedidos, itens e vendas;
  :Sobrescrever produtos (criar/atualizar) e gravar logs em `estoque_logs` (acao: create/update);
else (n찾o)
  :Para cada pedido do backup;
  if (pedido existe?) then (sim)
    :pular;
  else (n찾o)
    :criar pedido e itens;
  endif
  :Para cada venda do backup -> criar se ausente;
  :Para cada produto do backup -> se existe e estoque==0 ent찾o atualizar; ao atualizar gravar entrada em `estoque_logs` (acao: update, nota: 'restore safe');
endif
:Retornar relat처rio de resultado;
stop
@enduml
